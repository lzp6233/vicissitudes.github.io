# 计算机网络之 探赜索隐

## 传输层

传输层协议为运行在不同的Host上的进程提供了一种**逻辑通信机制**（端到端通信）

+ 端系统运行传输层协议
  + 发送方：将应用递交的消息分成一个或多个segment，并向下传递给网络层
  + 接收方：将接收到的segment组装成消息，并向上交给应用层
+ 分类
  + tcp
    + 拥塞控制
    + 流量控制
    + 连接建立
  + udp
    + Best-effort
+ 网络层：提供主机之间的逻辑通信机制
+ 传输层：提供应用进程之间的逻辑通信机制
  + 位于网络层之上
  + 依赖于网络层服务
  + 对网络层服务进行（可能的）增强

### 多路复用与多路分用

为什么需要多路复用/分用？

![image-20251201193530428](explore.assets/image-20251201193530428.png)

+ 接收端进行多路分用
  + 传输层依据头部信息将收到的Segment交给正确的Socket，即不同的进程
+ 发送端进行多路复用
  + 从多个Socket接收数据，为每个数据块封装头部信息，生成Segment，交给网络层

#### 多路分用

+ 主机接收IP数据报
  + 每个数据报携带源IP，目的IP
  + 每个数据报携带一个Segment
  + 源端口，目的端口号
+ 收到segment后，提取IP和port，将Segment导入对应的Socket
  + TCP做更多处理
  + 网络层对端口号透明

+ UDP的多路分用
  + 利用端口号创建Socket
  + 用二元组标识（目的IP，目的端口号）

![image-20251201195856939](explore.assets/image-20251201195856939.png)

+ TCP的多路分用使用四元组标识
  + 源IP
  + 源端口号
  + 目的IP
  + 目的端口号 
  + 服务器可能同时支持多个TCP socket
  + 可以使用面向线程的TCP

![image-20251201195526885](explore.assets/image-20251201195526885.png)

![image-20251201195741863](explore.assets/image-20251201195741863.png)

