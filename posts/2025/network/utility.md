# 计算机网络之 网尽其用

> 计算机网络是 互联的，自治的计算机集合
>
> + 自治–无主从关系
> + 互联互通 通信链路

## 通过交换网络互联主机

交换节点：路由器或交换机

## 什么是Internet

+ 全球最大的互联网络
  + ISP Internet Service Provider 
  + ISP 网络互连的网络之网络：移动网络，家庭网络，全球ISP，区域ISP，机构网络（如校园网）
+ 为网络应用提供通信服务的通信基础设施
+ 为网络应用提供应用编程接口

> 仅有硬件，网络能顺畅运行，有序交付数据吗？ 
>
> NO 还需要协议

## 网络协议

**数据交换必须遵从的规则**

协议规定了通信实体之间所交换的消息的格式，意义，顺序，以及针对收到信息或发生的事件所采取的动作

### 三要素

+ 语法 Syntax
+ 语义 Semantics
+ 时序 Timing

Internet协议标准

+ RFC：Request for Comments
+ IETF Internet Engineering Task Force 

## 计算机网络结构

网络边缘：

+ 主机（端系统）
  + 运行网络应用
  + 客户/服务器（client/server）应用模型
  + P2P模型（peer-peer)：不依赖专用服务器，实体之间直接进行通信

> 如何将网络边缘接入核心网络？
>
> + 住宅接入网络
> + 机构接入网络
> + 移动接入网络（无线）
>   + LANs 无线局域网
>   + 广域无线接入 手机流量
>
> 关心：
>
> + 带宽（数据传输速率）
> + 共享/独占

接入网络，物理介质：

+ 有线或无线通信链路

网路核心：

+ 互联的路由器（转发设备）
  + 关键功能：路由+转发
+ 网络之网络

> 核心问题：如何实现数据从源主机通过网络核心送达目的地的主机？
>
> A：数据交换

## Internet网络结构

+ 端系统通过接入ISP连接到Internet
+ ISP必须进一步互联

+ IXP：Internet exchange point 实现大型ISP之间互联

## 电路交换

不能点对点分别连接：使用交换设备，构建交换网络

> 什么是交换？
>
> + 动态转接
> + 动态分配传输资源

数据交换的类型：

+ 电路交换：电话网络
  + 建立电路连接
  + 通信
  + 释放连接
  + **资源独占型**

> 电路交换网络如何共享中继线？
>
> + 多路复用技术

+ 报文交换
+ 分组交换

## 多路复用技术（multiplexing)

+ 划分资源片
+ 每路独占分配到的资源片进行通信
+ 典型技术：
  + 频分度用FDM
  + 时分复用TDM：划分等长时间段（frame），用户使用固定序号的时隙
  + 波分复用
    + 光的频分复用
  + 码分复用 CDM
    + 广泛用于无线链路共享（蜂窝网，卫星通信）
    + 每个用户分配唯一的码片序列（+1，-1）
    + 每个用户使用相同频率载波，使用码片序列来编码
    + $编码信号=原始数据\times码片序列$
    + 各个用户码片序列正交

> - 令 $\{d_i\}$ 为原始数据序列，各用户的叠加向量为
>
> $$
> P = \sum_{i=1}^{N} d_i \cdot S_i = \sum_{i=1}^{N} S_i^{(-)}
> $$
>
> - **解码**: 码片序列与编码信号的内积
>
> $$
> \frac{1}{m} S_i \cdot P =
> \begin{cases}
> 1 & S_i \in P \\
> -1 & \overline{S}_i \in P \\
> 0 & S_i, \overline{S}_i \not\in P
> \end{cases}
> $$

## 报文交换与分组交换

### 报文交换

+ 电报

### 分组交换：统计多路复用

+ 需要报文的拆分和重组
+ 产生额外开销
+ 按需共享链路

> 那种更好呢？
>
> 传输延迟：
>
> + 分组交换
>   + 分组传输延迟$L/R$
>   + 传输更快，不用等待
>   + 需要的缓存小
> + 报文交换
>   + 传输延迟$M/R$
>   + 路由器需要很大缓存 

分组交换报文交付时间：
**- 报文: **M** bits
- 链路带宽（数据传输速率）: **R** bps
- 分组长度（大小）: **L** bits
- 跳步数: $ h $
- 路由器数: $ n $

$$
T = \frac{M}{R} + \frac{(h-1)L}{R}= \frac{M}{R} + \frac{nL}{R}
$$

> - **例：**
>   - **1 Mb/s链路**
>   - **每个用户：**
>     - “活动”时需 100 kb/s
>     - 平均活动时间 10%
>
> - **电路交换：**
>   - 10用户
>
> - **分组交换：**
>   - 对于 35个用户，大于 10 个用户同时活动的概率 < 0.0004
>
> 分组交换允许更多用户同时使用网络！ 适用于**突发数据传输网络**，可能产生拥塞 congestion

## 计算机网路的性能

`速率`：数据从传输速率，比特率，单位时间传输信息量

+ 单位 bps，kbps，Mbps，Gbps （1000的n次方）
+ 默认为额定速率，标称速率

`带宽`：与信号与系统的有区别，不代指频率，这里指数字信道所能传输的最大传输速率 bps

`延迟	`：

+ 节点处理延迟$d_{proc}$

  + 差错检测
  + 确定输出链路
  + 通常小于ms

+ 排队延迟$d_{queue}$

  + 等待输出链路可用

  + 取决于路由器拥塞程度

  + > - $ R $: 链路带宽 (bps)
    >
    > - $ L $: 分组长度 (bits)
    >
    > - $ a $: 平均分组到达速率
    >
    >   **流量强度**（traffic intensity）
    >
    > $$
    > \text{流量强度} = \frac{La}{R}
    > $$
    >
    > - $ La/R \sim 0 $: 平均排队延迟很小
    > - $ La/R \to 1 $: 平均排队延迟很大
    > - $ La/R > 1 $: 超出服务能力，平均排队延迟无限大！

+ 传输延迟$d_{trans}$

  + 分组长度
  + 链路带宽

+ 传播延迟$d_{prop}$

  + 链路长度
  + 传播速度 ($\approx 2\times10^8$ m/s)
  + $d_{porp}=d/s$

$$
d_{\text{nodal}} = d_{\text{proc}} + d_{\text{queue}} + d_{\text{trans}} + d_{\text{prop}}
$$

> 分组交换为什么产生丢包和时延？
>
> + 分组在路由器缓存中排队
>   + **分组到达速率超出输出链路容量时**
>   + 分组排队，等待输出链路可用

`时延带宽积`：时延带宽积 = 传播时延 × 带宽

+ 结果是数据量，相当于链路的容纳量

`分组丢失`（丢包）

+ 队列缓存容量有限
+ 分组到达已满队列将被丢弃
+ 丢弃分组可能有前序节点或源重发

$$
\text{丢包率} = \frac{\text{丢包数}}{\text{已发分组总数}}
$$

`吞吐量`：发送端到接收端之间的数据传输速率

+ 即时吞吐量
+ 平均吞吐量
+ internet场景
  + 每条“连接”的端到端吞吐量：$\min(R_C, R_S, R/N)$
  - 实际网络：$R_C$ 或 $R_S$ 通常是瓶颈

![image-20251128144756017](utility.assets/image-20251128144756017.png)

## 计算机网络体系结构

**分层结构**很好的描述了计算机网络的体系结构

基本概念

![image-20251128165715525](utility.assets/image-20251128165715525.png)

- **实体**(entity) 表示任何可发送或接收信息的硬件或软件进程。
- 协议是控制**两个对等实体**进行通信的规则的集合，协议是“**水平的**”。
- 任一层实体需要使用**下层服务**，遵循本层协议，实现本层功能，向**上层提供服务**，服务是“**垂直的**”。
- 下层协议的实现对上层的服务用户是**透明的**。
- 同系统的相邻层实体间通过**接口**进行交互，通过**服务访问点 SAP** (Service Access Point)，交换**原语**，指定请求的特定服务。

## OSI参考模型

目的是支持异构网络系统的互联互通

理论成功，市场失败。理解网络通信的最佳学习工具

1. 物理层
2. 数据链路层
3. 网络层
4. 传输层 后面是端到端层 end-to-end 
5. 会话层
6. 表示层
7. 应用层

![image-20251128170505121](utility.assets/image-20251128170505121.png)

![image-20251128171115087](utility.assets/image-20251128171115087.png)

### 为什么需要数据封装

+ 增加控制信息
  + 构造协议数据单元 (PDU)

+ 控制信息主要包括:
  + **地址（Address）**: 标识发送端/接收端
  + **差错检测编码（Error-detecting code）**: 用于差错检测或纠正
  + **协议控制（Protocol control）**: 实现协议功能的附加信息，如: 优先级（priority）、服务质量（QoS）、和安全控制等

  

### 物理层功能

实现每个bit的传输

+ 接口特性
  + 机械特性，电气特性，功能特性，规程特性
+ 比特编码
+ 数据率（传输速率）
+ bit同步
  + 时钟同步
+ 传输模式
  + 单工（simplex）
  + 半双工（half-duplux）（对讲机）
  + 全双工（full-duplex）

### 数据链路层功能

+ **负责节点到节点的数据传输**

+ **组帧（framing）** 
+ **物理寻址（physical addressing）**
+ 流量控制（flow control）
+ 差错控制（Error control）
+ 访问控制
  + 在任意指定时刻决定那个设备拥有链路控制使用权

![image-20251129141913284](utility.assets/image-20251129141913284.png)

### 网络层功能

+ 负责源主机到目的主机数据分组的交付
  + 可能穿越多个网络
+ 逻辑寻址
  + 全局唯一的逻辑地址，如IP地址
+ 路由（routing）
+ 分组转发

### 传输层功能

+ 负责源-目的（端到端），进程间完整报文的传输
+ 分段与重组
+ SAP寻址
  + 确保将完整报文提交给正确进程（端口）
  + ![image-20251129142658328](utility.assets/image-20251129142658328.png)
+ 连接控制（逻辑连接）
+ 流量控制
+ 差错控制

### 会话层功能

+ 对话控制（dialog controling）
+ 同步
  + 在数据流中插入同步点
+ 最薄的一层

### 表示层（集成到应用层）

+ 处理两个系统之间交换信息的语法与语义的问题
+ 数据表示转化
  + 大端序与小端序
+ 加密解密
+ 压缩解压缩

### 应用层

+ 支持用户通过用户代理或网络接口使用网络（服务）
+ 文件传输（FTP）
+ 电子邮件（SMTP）
+ Web（HTTP）

## TCP/IP 参考模型

![image-20251129143305646](utility.assets/image-20251129143305646.png)

>  **Everything over IP**

## 五层参考模型（应用最多）

综合了OSI和TCP/IP的优点

- **应用层**: 支持各种网络应用
  - FTP, SMTP, HTTP

- **传输层**: 进程-进程的数据传输
  - TCP, UDP

- **网络层**: 源主机到目的主机的数据分组路由与转发
  - IP协议、路由协议等

- **链路层**: 相邻网络元素（主机、交换机、路由器等）的数据传输
  - 以太网（Ethernet）、802.11 (WiFi)、PPP

- **物理层**: 比特传输

![image-20251129144130578](utility.assets/image-20251129144130578.png)

### 计算机网络与Internet发展历史

 

## 网络应用层

### 网络应用的体系结构

> 1. client/server
> 2. Peer-to-Peer
> 3. Hybrid

#### CS结构

+ 服务器
  + 24h提供服务
  + 永久性访问的地址/域名
  + 利用大量服务器实现可扩展性
+ 客户机
  + 与服务器通信，使用服务
  + 间歇性接入网络
  + 可能使用动态ip
  + 不与其他用户直接通信

![image-20251129151231521](utility.assets/image-20251129151231521.png)

#### (纯)P2P结构

+ 没有永远在线的服务器
+ 任意节点之间可以直接通信
+ 可以间歇性接入网络
+ 节点可以改变ip
+ 优点：高度可伸缩
+ 缺点：难于管理

#### 混合结构

**Napster**

+ 文件传输使用P2P
+ 文件搜索使用CS结构
  + 向中央服务器提价查询请求，查找对应内容

![image-20251129151648524](utility.assets/image-20251129151648524.png)

### 网络应用进程通信

